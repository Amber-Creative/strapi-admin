"use strict";(self.webpackChunk_strapi_admin=self.webpackChunk_strapi_admin||[]).push([[2282],{51509:function(H,O,s){s.r(O),s.d(O,{ProvidersPage:function(){return V},default:function(){return oe}});var e=s(32735),v=s(5636),o=s(13478),P=s(23973),c=s.n(P),$=s(23940),x=s.n($),t=s(39161),B=s(57269),M=s(84968),r=s(5173),n=s(59677);const U={id:(0,n.OB)("PopUpForm.Providers.redirectURL.front-end.label"),defaultMessage:"The redirect URL to your front-end app"},C={id:"http://www.client-app.com",defaultMessage:"http://www.client-app.com"},T={id:(0,n.OB)("PopUpForm.Providers.enabled.description"),defaultMessage:"If disabled, users won't be able to use this provider."},I={id:(0,n.OB)("PopUpForm.Providers.enabled.label"),defaultMessage:"Enable"},G={id:(0,n.OB)("PopUpForm.Providers.key.label"),defaultMessage:"Client ID"},X={id:(0,n.OB)("PopUpForm.Providers.redirectURL.label"),defaultMessage:"The redirect URL to add in your {provider} application configurations"},Z={id:(0,n.OB)("PopUpForm.Providers.key.placeholder"),defaultMessage:"TEXT"},K={id:(0,n.OB)("PopUpForm.Providers.secret.label"),defaultMessage:"Client Secret"};var w={email:{form:[[{intlLabel:I,name:"enabled",type:"bool",description:T,size:6}]],schema:r.Ry().shape({enabled:r.Xg().required(o.translatedErrors.required)})},providers:{form:[[{intlLabel:I,name:"enabled",type:"bool",description:T,size:6,validations:{required:!0}}],[{intlLabel:G,name:"key",type:"text",placeholder:Z,size:12,validations:{required:!0}}],[{intlLabel:K,name:"secret",type:"text",placeholder:Z,size:12,validations:{required:!0}}],[{intlLabel:U,placeholder:C,name:"callback",type:"text",size:12,validations:{required:!0}}],[{intlLabel:X,name:"noName",type:"text",validations:{},size:12,disabled:!0}]],schema:r.Ry().shape({enabled:r.Xg().required(o.translatedErrors.required),key:r.Z_().when("enabled",{is:!0,then:r.Z_().required(o.translatedErrors.required),otherwise:r.Z_()}),secret:r.Z_().when("enabled",{is:!0,then:r.Z_().required(o.translatedErrors.required),otherwise:r.Z_()}),callback:r.Z_().when("enabled",{is:!0,then:r.Z_().required(o.translatedErrors.required),otherwise:r.Z_()})})},providersWithSubdomain:{form:[[{intlLabel:I,name:"enabled",type:"bool",description:T,size:6,validations:{required:!0}}],[{intlLabel:G,name:"key",type:"text",placeholder:Z,size:12,validations:{required:!0}}],[{intlLabel:K,name:"secret",type:"text",placeholder:Z,size:12,validations:{required:!0}}],[{intlLabel:{id:(0,n.OB)({id:"PopUpForm.Providers.jwksurl.label"}),defaultMessage:"JWKS URL"},name:"jwksurl",type:"text",placeholder:Z,size:12,validations:{required:!1}}],[{intlLabel:{id:(0,n.OB)("PopUpForm.Providers.subdomain.label"),defaultMessage:"Host URI (Subdomain)"},name:"subdomain",type:"text",placeholder:{id:(0,n.OB)("PopUpForm.Providers.subdomain.placeholder"),defaultMessage:"my.subdomain.com"},size:12,validations:{required:!0}}],[{intlLabel:U,placeholder:C,name:"callback",type:"text",size:12,validations:{required:!0}}],[{intlLabel:X,name:"noName",type:"text",validations:{},size:12,disabled:!0}]],schema:r.Ry().shape({enabled:r.Xg().required(o.translatedErrors.required),key:r.Z_().when("enabled",{is:!0,then:r.Z_().required(o.translatedErrors.required),otherwise:r.Z_()}),secret:r.Z_().when("enabled",{is:!0,then:r.Z_().required(o.translatedErrors.required),otherwise:r.Z_()}),subdomain:r.Z_().when("enabled",{is:!0,then:r.Z_().required(o.translatedErrors.required),otherwise:r.Z_()}),callback:r.Z_().when("enabled",{is:!0,then:r.Z_().required(o.translatedErrors.required),otherwise:r.Z_()})})}};const _=async i=>{try{const{data:m}=await n.be.get((0,n.Gc)("providers"));return m}catch{throw i({type:"warning",message:{id:"notification.error"}}),new Error("error")}},ee=i=>n.be.put((0,n.Gc)("providers"),i);var te=s(92891),ae=i=>(0,te.sortBy)(Object.keys(i).reduce((m,g)=>{const{icon:f,enabled:u,subdomain:y}=i[g],p=f==="envelope"?["fas","envelope"]:["fab",f];return y!==void 0?m.push({name:g,icon:p,enabled:u,subdomain:y}):m.push({name:g,icon:p,enabled:u}),m},[]),"name"),Q=s(88369),re=s(60216),a=s.n(re),se=s(83281);const A=({description:i,disabled:m,intlLabel:g,error:f,name:u,onChange:y,placeholder:p,providerToEditName:L,type:E,value:l})=>{const{formatMessage:b}=(0,v.useIntl)(),R=u==="noName"?`${strapi.backendURL}/api/connect/${L}/callback`:l,q=b({id:g.id,defaultMessage:g.defaultMessage},{provider:L,...g.values}),h=i?b({id:i.id,defaultMessage:i.defaultMessage},{provider:L,...i.values}):"";if(E==="bool")return e.createElement(t.ToggleInput,{"aria-label":u,checked:l,disabled:m,hint:h,label:q,name:u,offLabel:b({id:"app.components.ToggleCheckbox.off-label",defaultMessage:"Off"}),onLabel:b({id:"app.components.ToggleCheckbox.on-label",defaultMessage:"On"}),onChange:k=>{y({target:{name:u,value:k.target.checked}})}});const z=p?b({id:p.id,defaultMessage:p.defaultMessage},{...p.values}):"",j=f?b({id:f,defaultMessage:f}):"";return e.createElement(t.TextInput,{"aria-label":u,disabled:m,error:j,label:q,name:u,onChange:y,placeholder:z,type:E,value:R})};A.defaultProps={description:null,disabled:!1,error:"",placeholder:null,value:""},A.propTypes={description:a().shape({id:a().string.isRequired,defaultMessage:a().string.isRequired,values:a().object}),disabled:a().bool,error:a().string,intlLabel:a().shape({id:a().string.isRequired,defaultMessage:a().string.isRequired,values:a().object}).isRequired,name:a().string.isRequired,onChange:a().func.isRequired,placeholder:a().shape({id:a().string.isRequired,defaultMessage:a().string.isRequired,values:a().object}),providerToEditName:a().string.isRequired,type:a().string.isRequired,value:a().oneOfType([a().bool,a().string])};var ne=A;const D=({headerBreadcrumbs:i,initialData:m,isSubmiting:g,layout:f,isOpen:u,onSubmit:y,onToggle:p,providerToEditName:L})=>{const{formatMessage:E}=(0,v.useIntl)();return u?e.createElement(t.ModalLayout,{onClose:p,labelledBy:"title"},e.createElement(t.ModalHeader,null,e.createElement(t.Breadcrumbs,{label:i.join(", ")},i.map(l=>e.createElement(t.Crumb,{key:l},l)))),e.createElement(se.Formik,{onSubmit:l=>y(l),initialValues:m,validationSchema:f.schema,validateOnChange:!1},({errors:l,handleChange:b,values:R})=>e.createElement(o.Form,null,e.createElement(t.ModalBody,null,e.createElement(t.Stack,{spacing:1},e.createElement(t.Grid,{gap:5},f.form.map(q=>q.map(h=>e.createElement(t.GridItem,{key:h.name,col:h.size,xs:12},e.createElement(ne,{...h,error:l[h.name],onChange:b,value:R[h.name],providerToEditName:L}))))))),e.createElement(t.ModalFooter,{startActions:e.createElement(t.Button,{variant:"tertiary",onClick:p,type:"button"},E({id:"app.components.Button.cancel",defaultMessage:"Cancel"})),endActions:e.createElement(t.Button,{type:"submit",loading:g},E({id:"global.save",defaultMessage:"Save"}))})))):null};D.defaultProps={initialData:null,providerToEditName:null},D.propTypes={headerBreadcrumbs:a().arrayOf(a().string).isRequired,initialData:a().object,layout:a().shape({form:a().arrayOf(a().array),schema:a().object}).isRequired,isOpen:a().bool.isRequired,isSubmiting:a().bool.isRequired,onSubmit:a().func.isRequired,onToggle:a().func.isRequired,providerToEditName:a().string};var ie=D;const V=()=>{const{formatMessage:i}=(0,v.useIntl)();(0,o.useFocusWhenNavigate)();const{notifyStatus:m}=(0,t.useNotifyAT)(),g=(0,M.useQueryClient)(),{trackUsage:f}=(0,o.useTracking)(),u=(0,e.useRef)(f),[y,p]=(0,e.useState)(!1),[L,E]=(0,e.useState)(!1),[l,b]=(0,e.useState)(null),R=(0,o.useNotification)(),{lockApp:q,unlockApp:h}=(0,o.useOverlayBlocker)(),z=(0,e.useMemo)(()=>({update:Q.Z.updateProviders}),[]),{isLoading:j,allowedActions:{canUpdate:k}}=(0,o.useRBAC)(z),{isLoading:le,data:S,isFetching:de}=(0,M.useQuery)("get-providers",()=>_(R),{onSuccess(){m(i({id:(0,n.OB)("Providers.data.loaded"),defaultMessage:"Providers have been loaded"}))},initialData:{}}),ue=le||de,ce=(0,M.useMutation)(ee,{async onSuccess(){await g.invalidateQueries("get-providers"),R({type:"info",message:{id:(0,n.OB)("notification.success.submit")}}),u.current("didEditAuthenticationProvider"),E(!1),N(),h()},onError(){R({type:"warning",message:{id:"notification.error"}}),h(),E(!1)},refetchActive:!1}),F=(0,e.useMemo)(()=>ae(S),[S]),me=F.length,J=(0,e.useMemo)(()=>{if(!l)return!1;const d=F.find(W=>W.name===l);return c()(d,"subdomain")},[F,l]),pe=i({id:(0,n.OB)("HeaderNav.link.providers"),defaultMessage:"Providers"}),ge=(0,e.useMemo)(()=>l==="email"?w.email:J?w.providersWithSubdomain:w.providers,[l,J]),N=()=>{p(d=>!d)},Y=d=>{k&&(b(d.name),N())},fe=async d=>{E(!0),q(),u.current("willEditAuthenticationProvider");const W={...S,[l]:d};ce.mutate({providers:W})};return e.createElement(t.Layout,null,e.createElement(o.SettingsPageTitle,{name:pe}),e.createElement(t.Main,null,e.createElement(t.HeaderLayout,{title:i({id:(0,n.OB)("HeaderNav.link.providers"),defaultMessage:"Providers"})}),ue||j?e.createElement(o.LoadingIndicatorPage,null):e.createElement(t.ContentLayout,null,e.createElement(t.Table,{colCount:3,rowCount:me+1},e.createElement(t.Thead,null,e.createElement(t.Tr,null,e.createElement(t.Th,null,e.createElement(t.Typography,{variant:"sigma",textColor:"neutral600"},i({id:"global.name",defaultMessage:"Name"}))),e.createElement(t.Th,null,e.createElement(t.Typography,{variant:"sigma",textColor:"neutral600"},i({id:(0,n.OB)("Providers.status"),defaultMessage:"Status"}))),e.createElement(t.Th,null,e.createElement(t.Typography,{variant:"sigma"},e.createElement(t.VisuallyHidden,null,i({id:"global.settings",defaultMessage:"Settings"})))))),e.createElement(t.Tbody,null,F.map(d=>e.createElement(t.Tr,{key:d.name,...(0,o.onRowClick)({fn:()=>Y(d),condition:k})},e.createElement(t.Td,{width:"45%"},e.createElement(t.Typography,{fontWeight:"semiBold",textColor:"neutral800"},d.name)),e.createElement(t.Td,{width:"65%"},e.createElement(t.Typography,{textColor:d.enabled?"success600":"danger600","data-testid":`enable-${d.name}`},d.enabled?i({id:"global.enabled",defaultMessage:"Enabled"}):i({id:"global.disabled",defaultMessage:"Disabled"}))),e.createElement(t.Td,{...o.stopPropagation},k&&e.createElement(t.IconButton,{onClick:()=>Y(d),noBorder:!0,icon:e.createElement(B.Pencil,null),label:"Edit"})))))))),e.createElement(ie,{initialData:S[l],isOpen:y,isSubmiting:L,layout:ge,headerBreadcrumbs:[i({id:(0,n.OB)("PopUpForm.header.edit.providers"),defaultMessage:"Edit Provider"}),x()(l)],onToggle:N,onSubmit:fe,providerToEditName:l}))};var oe=()=>e.createElement(o.CheckPagePermissions,{permissions:Q.Z.readProviders},e.createElement(V,null))},8917:function(H,O,s){var e=s(55721),v=s(13478),o=s.n(v);const P=e.Z.create({baseURL:"http://localhost:1337"});P.interceptors.request.use(async c=>(c.headers={Authorization:`Bearer ${v.auth.getToken()}`,Accept:"application/json","Content-Type":"application/json"},c),c=>{Promise.reject(c)}),P.interceptors.response.use(c=>c,c=>{throw c.response?.status===401&&(v.auth.clearAppStorage(),window.location.reload()),c}),O.Z=P},59677:function(H,O,s){s.d(O,{be:function(){return e.Z},YX:function(){return P},Gc:function(){return x},OB:function(){return t.Z}});var e=s(8917),v=s(92891),P=B=>Object.keys(B).reduce((M,r)=>{const n=B[r].controllers,U=Object.keys(n).reduce((C,T)=>((0,v.isEmpty)(n[T])||(C[T]=n[T]),C),{});return(0,v.isEmpty)(U)||(M[r]={controllers:U}),M},{}),c=s(90201),x=B=>`/${c.Z}/${B}`,t=s(82069)}}]);
