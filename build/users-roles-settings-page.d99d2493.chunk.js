"use strict";(self.webpackChunk_strapi_admin=self.webpackChunk_strapi_admin||[]).push([[8853],{77495:function(K,M,o){o.r(M),o.d(M,{default:function(){return st}});var e=o(32735),C=o(5141),d=o(13478),R=o(90201),h=o(88369),a=o(39161),k=o(57269),P=o(5636),S=o(84968),U=o(58469),b=o(59677);const I=async(t,n)=>{try{const{data:s}=await b.be.get((0,b.Gc)("roles"));return n("The roles have loaded successfully"),s}catch{throw t({type:"warning",message:{id:"notification.error"}}),new Error("error")}},G=async(t,n)=>{try{await b.be.delete(`${(0,b.Gc)("roles")}/${t}`)}catch{n({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}};var Z=o(60216),y=o.n(Z);const V=({sortedRoles:t,canDelete:n,permissions:s,setRoleToDelete:r,onDelete:m})=>{const{formatMessage:i}=(0,P.useIntl)(),{push:l}=(0,C.useHistory)(),[u,g]=m,p=c=>n&&!["public","authenticated"].includes(c.type),E=c=>{r(c),g(!u)},f=c=>{l(`/settings/${R.Z}/roles/${c}`)};return e.createElement(a.Tbody,null,t?.map(c=>e.createElement(a.Tr,{key:c.name,...(0,d.onRowClick)({fn:()=>f(c.id)})},e.createElement(a.Td,{width:"20%"},e.createElement(a.Typography,null,c.name)),e.createElement(a.Td,{width:"50%"},e.createElement(a.Typography,null,c.description)),e.createElement(a.Td,{width:"30%"},e.createElement(a.Typography,null,`${c.nb_users} ${i({id:"global.users",defaultMessage:"users"}).toLowerCase()}`)),e.createElement(a.Td,null,e.createElement(a.Flex,{justifyContent:"end",...d.stopPropagation},e.createElement(d.CheckPermissions,{permissions:s.updateRole},e.createElement(a.IconButton,{onClick:()=>f(c.id),noBorder:!0,icon:e.createElement(k.Pencil,null),label:i({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:`${c.name}`})})),p(c)&&e.createElement(d.CheckPermissions,{permissions:s.deleteRole},e.createElement(a.IconButton,{onClick:()=>E(c.id),noBorder:!0,icon:e.createElement(k.Trash,null),label:i({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${c.name}`})})))))))};var ye=V;V.defaultProps={canDelete:!1},V.propTypes={onDelete:y().array.isRequired,permissions:y().object.isRequired,setRoleToDelete:y().func.isRequired,sortedRoles:y().array.isRequired,canDelete:y().bool};var fe=()=>{const{trackUsage:t}=(0,d.useTracking)(),{formatMessage:n}=(0,P.useIntl)(),{push:s}=(0,C.useHistory)(),r=(0,d.useNotification)(),{notifyStatus:m}=(0,a.useNotifyAT)(),[{query:i}]=(0,d.useQueryParams)(),l=i?._q||"",[u,g]=(0,e.useState)(!1),[p,E]=(0,e.useState)(!1),[f,c]=(0,e.useState)();(0,d.useFocusWhenNavigate)();const T=(0,S.useQueryClient)(),v=(0,e.useMemo)(()=>({create:h.Z.createRole,read:h.Z.readRoles,update:h.Z.updateRole,delete:h.Z.deleteRole}),[]),{isLoading:A,allowedActions:{canRead:D,canDelete:x}}=(0,d.useRBAC)(v),{isLoading:nt,data:{roles:Ee},isFetching:at}=(0,S.useQuery)("get-roles",()=>I(r,m),{initialData:{},enabled:D}),he=nt||at,rt=()=>{t("willCreateRole"),s(`/settings/${R.Z}/roles/new`)},ot=()=>{g(!u)},it={roles:{id:(0,b.OB)("Roles.empty"),defaultMessage:"You don't have any roles yet."},search:{id:(0,b.OB)("Roles.empty.search"),defaultMessage:"No roles match the search."}},lt=n({id:"global.roles",defaultMessage:"Roles"}),ct=(0,S.useMutation)(pt=>G(pt,r),{async onSuccess(){await T.invalidateQueries("get-roles")}}),ut=async()=>{E(!0),await ct.mutateAsync(f),g(!u),E(!1)},H=(0,U.ZP)(Ee||[],l,{keys:["name","description"]}),dt=l&&!H.length?"search":"roles",mt=4,gt=(Ee?.length||0)+1;return e.createElement(a.Layout,null,e.createElement(d.SettingsPageTitle,{name:lt}),e.createElement(a.Main,{"aria-busy":he},e.createElement(a.HeaderLayout,{title:n({id:"global.roles",defaultMessage:"Roles"}),subtitle:n({id:"Settings.roles.list.description",defaultMessage:"List of roles"}),primaryAction:e.createElement(d.CheckPermissions,{permissions:h.Z.createRole},e.createElement(a.Button,{onClick:rt,startIcon:e.createElement(k.Plus,null),size:"S"},n({id:(0,b.OB)("List.button.roles"),defaultMessage:"Add new role"})))}),e.createElement(a.ActionLayout,{startActions:e.createElement(d.SearchURLQuery,{label:n({id:"app.component.search.label",defaultMessage:"Search"})})}),e.createElement(a.ContentLayout,null,!D&&e.createElement(d.NoPermissions,null),(he||A)&&e.createElement(d.LoadingIndicatorPage,null),D&&H&&H?.length?e.createElement(a.Table,{colCount:mt,rowCount:gt},e.createElement(a.Thead,null,e.createElement(a.Tr,null,e.createElement(a.Th,null,e.createElement(a.Typography,{variant:"sigma",textColor:"neutral600"},n({id:"global.name",defaultMessage:"Name"}))),e.createElement(a.Th,null,e.createElement(a.Typography,{variant:"sigma",textColor:"neutral600"},n({id:"global.description",defaultMessage:"Description"}))),e.createElement(a.Th,null,e.createElement(a.Typography,{variant:"sigma",textColor:"neutral600"},n({id:"global.users",defaultMessage:"Users"}))),e.createElement(a.Th,null,e.createElement(a.VisuallyHidden,null,n({id:"global.actions",defaultMessage:"Actions"}))))),e.createElement(ye,{sortedRoles:H,canDelete:x,permissions:h.Z,setRoleToDelete:c,onDelete:[u,g]})):e.createElement(d.EmptyStateLayout,{content:it[dt]})),e.createElement(d.ConfirmDialog,{isConfirmButtonLoading:p,onConfirm:ut,onToggleDialog:ot,isOpen:u})))},Re=()=>e.createElement(d.CheckPagePermissions,{permissions:h.Z.accessRoles},e.createElement(fe,null)),Q=o(83281),Y=o(28356),X=o(17e3),J=o(27649),q=o(41415),N=o(27677),_=o(72850),ee=o(10369),te=o(10508),se=o(49372),Ce=o(29439),ne=o(66456),ae=o(15335),$=o(5803),O=o(82069),L=o(92891);const re=(0,e.createContext)({}),oe=({children:t,value:n})=>e.createElement(re.Provider,{value:n},t),W=()=>(0,e.useContext)(re);oe.propTypes={children:y().node.isRequired,value:y().object.isRequired};var w=o(83292),ve=o(37213),Te=o.n(ve),Pe=o(15738),be=o.n(Pe),Ae=t=>{switch(t){case"POST":return{text:"success600",border:"success200",background:"success100"};case"GET":return{text:"secondary600",border:"secondary200",background:"secondary100"};case"PUT":return{text:"warning600",border:"warning200",background:"warning100"};case"DELETE":return{text:"danger600",border:"danger200",background:"danger100"};default:return{text:"neutral600",border:"neutral200",background:"neutral100"}}};const De=(0,w.default)(a.Box)`
  margin: -1px;
  border-radius: ${({theme:t})=>t.spaces[1]} 0 0 ${({theme:t})=>t.spaces[1]};
`;function z({route:t}){const{formatMessage:n}=(0,P.useIntl)(),{method:s,handler:r,path:m}=t,i=m?be()(m.split("/")):[],[l="",u=""]=r?r.split("."):[],g=Ae(t.method);return e.createElement(a.Stack,{spacing:2},e.createElement(a.Typography,{variant:"delta",as:"h3"},n({id:"users-permissions.BoundRoute.title",defaultMessage:"Bound route to"}),"\xA0",e.createElement("span",null,l),e.createElement(a.Typography,{variant:"delta",textColor:"primary600"},".",u)),e.createElement(a.Stack,{horizontal:!0,hasRadius:!0,background:"neutral0",borderColor:"neutral200",spacing:0},e.createElement(De,{background:g.background,borderColor:g.border,padding:2},e.createElement(a.Typography,{fontWeight:"bold",textColor:g.text},s)),e.createElement(a.Box,{paddingLeft:2,paddingRight:2},Te()(i,p=>e.createElement(a.Typography,{key:p,textColor:p.includes(":")?"neutral600":"neutral900"},"/",p)))))}z.defaultProps={route:{handler:"Nocontroller.error",method:"GET",path:"/there-is-no-path"}},z.propTypes={route:y().shape({handler:y().string,method:y().string,path:y().string})};var Le=z,Se=()=>{const{formatMessage:t}=(0,P.useIntl)(),{selectedAction:n,routes:s}=W(),r=(0,L.without)(n.split("."),"controllers"),m=(0,L.get)(s,r[0]),i=r.slice(1).join("."),l=(0,L.isEmpty)(m)?[]:m.filter(u=>u.handler.endsWith(i));return e.createElement(a.GridItem,{col:5,background:"neutral150",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,style:{minHeight:"100%"}},n?e.createElement(a.Stack,{spacing:2},l.map((u,g)=>e.createElement(Le,{key:g,route:u}))):e.createElement(a.Stack,{spacing:2},e.createElement(a.Typography,{variant:"delta",as:"h3"},t({id:"users-permissions.Policies.header.title",defaultMessage:"Advanced settings"})),e.createElement(a.Typography,{as:"p",textColor:"neutral600"},t({id:"users-permissions.Policies.header.hint",defaultMessage:"Select the application's actions or the plugin's actions and click on the cog icon to display the bound route"}))))},Me=o(23940),ke=o.n(Me);function Oe(t){switch(t){case"application":return"Application";case"plugin::content-manager":return"Content manager";case"plugin::content-type-builder":return"Content types builder";case"plugin::documentation":return"Documentation";case"plugin::email":return"Email";case"plugin::i18n":return"i18n";case"plugin::upload":return"Upload";case"plugin::users-permissions":return"Users-permissions";default:return ke()(t.replace("api::","").replace("plugin::",""))}}var Be=Oe,xe=o(98978),ie=o.n(xe);const le=w.css`
  background: ${t=>t.theme.colors.primary100};
  svg {
    opacity: 1;
  }
`;var Ue=(0,w.default)(a.Box)`
  display: flex;
  justify-content: space-between;
  align-items: center;

  svg {
    opacity: 0;
    path {
      fill: ${t=>t.theme.colors.primary600};
    }
  }

  /* Show active style both on hover and when the action is selected */
  ${t=>t.isActive&&le}
  &:hover {
    ${le}
  }
`;const Ie=w.default.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:t})=>t.colors.neutral150};
`,ce=({subCategory:t})=>{const{formatMessage:n}=(0,P.useIntl)(),{onChange:s,onChangeSelectAll:r,onSelectedAction:m,selectedAction:i,modifiedData:l}=W(),u=(0,e.useMemo)(()=>(0,L.get)(l,t.name,{}),[l,t]),g=(0,e.useMemo)(()=>Object.values(u).every(c=>c.enabled===!0),[u]),p=(0,e.useMemo)(()=>Object.values(u).some(c=>c.enabled===!0)&&!g,[u,g]),E=(0,e.useCallback)(({target:{name:c}})=>{r({target:{name:c,value:!g}})},[g,r]),f=(0,e.useCallback)(c=>i===c,[i]);return e.createElement(a.Box,null,e.createElement(a.Flex,{justifyContent:"space-between",alignItems:"center"},e.createElement(a.Box,{paddingRight:4},e.createElement(a.Typography,{variant:"sigma",textColor:"neutral600"},t.label)),e.createElement(Ie,null),e.createElement(a.Box,{paddingLeft:4},e.createElement(a.Checkbox,{name:t.name,value:g,onValueChange:c=>E({target:{name:t.name,value:c}}),indeterminate:p},n({id:"app.utils.select-all",defaultMessage:"Select all"})))),e.createElement(a.Flex,{paddingTop:6,paddingBottom:6},e.createElement(a.Grid,{gap:2,style:{flex:1}},t.actions.map(c=>{const T=`${c.name}.enabled`;return e.createElement(a.GridItem,{col:6,key:c.name},e.createElement(Ue,{isActive:f(c.name),padding:2,hasRadius:!0},e.createElement(a.Checkbox,{value:(0,L.get)(l,T,!1),name:T,onValueChange:v=>s({target:{name:T,value:v}})},c.label),e.createElement("button",{type:"button","data-testid":"action-cog",onClick:()=>m(c.name),style:{display:"inline-flex",alignItems:"center"}},e.createElement(k.Cog,null))))}))))};ce.propTypes={subCategory:y().object.isRequired};var Ze=ce;const ue=({name:t,permissions:n})=>{const s=(0,e.useMemo)(()=>ie()(Object.values(n.controllers).reduce((r,m,i)=>{const l=`${t}.controllers.${Object.keys(n.controllers)[i]}`,u=ie()(Object.keys(m).reduce((g,p)=>[...g,{...m[p],label:p,name:`${l}.${p}`}],[]),"label");return[...r,{actions:u,label:Object.keys(n.controllers)[i],name:l}]},[]),"label"),[t,n]);return e.createElement(a.Box,{padding:6},s.map(r=>e.createElement(Ze,{key:r.name,subCategory:r})))};ue.propTypes={name:y().string.isRequired,permissions:y().object.isRequired};var Ge=ue,Ne=(t,n)=>{const s=Object.keys(n).sort().map(r=>({name:r,isOpen:!1}));return{...t,collapses:s}},F=o(97889);const $e={collapses:[]},we=(t,n)=>(0,F.default)(t,s=>{switch(n.type){case"TOGGLE_COLLAPSE":{s.collapses=t.collapses.map((r,m)=>m===n.index?{...r,isOpen:!r.isOpen}:{...r,isOpen:!1});break}default:return s}});var Fe=()=>{const{modifiedData:t}=W(),{formatMessage:n}=(0,P.useIntl)(),[{collapses:s},r]=(0,e.useReducer)(we,$e,i=>Ne(i,t)),m=i=>r({type:"TOGGLE_COLLAPSE",index:i});return e.createElement(a.Stack,{spacing:1},s.map((i,l)=>e.createElement(a.Accordion,{expanded:i.isOpen,onToggle:()=>m(l),key:i.name,variant:l%2===0?"secondary":void 0},e.createElement(a.AccordionToggle,{title:Be(i.name),description:n({id:"users-permissions.Plugin.permissions.plugins.description",defaultMessage:"Define all allowed actions for the {name} plugin."},{name:i.name}),variant:l%2?"primary":"secondary"}),e.createElement(a.AccordionContent,null,e.createElement(a.Box,null,e.createElement(Ge,{permissions:t[i.name],name:i.name}))))))};const je={initialData:{},modifiedData:{},routes:{},selectedAction:"",policies:[]};var He=(t,n)=>(0,F.default)(t,s=>{switch(n.type){case"ON_CHANGE":{const r=n.keys.length,m=n.keys[r-1]==="enabled";if(n.value&&m){const i=(0,L.take)(n.keys,r-1).join(".");s.selectedAction=i}(0,L.set)(s,["modifiedData",...n.keys],n.value);break}case"ON_CHANGE_SELECT_ALL":{const r=["modifiedData",...n.keys],m=(0,L.get)(t,r,{}),i=Object.keys(m).reduce((l,u)=>(l[u]={...m[u],enabled:n.value},l),{});(0,L.set)(s,r,i);break}case"ON_RESET":{s.modifiedData=t.initialData;break}case"ON_SUBMIT_SUCCEEDED":{s.initialData=t.modifiedData;break}case"SELECT_ACTION":{const{actionToSelect:r}=n;s.selectedAction=r===t.selectedAction?"":r;break}default:return s}}),Ve=(t,n,s)=>({...t,initialData:n,modifiedData:n,routes:s});const de=(0,e.forwardRef)(({permissions:t,routes:n},s)=>{const{formatMessage:r}=(0,P.useIntl)(),[m,i]=(0,e.useReducer)(He,je,E=>Ve(E,t,n));(0,e.useImperativeHandle)(s,()=>({getPermissions(){return{permissions:m.modifiedData}},resetForm(){i({type:"ON_RESET"})},setFormAfterSubmit(){i({type:"ON_SUBMIT_SUCCEEDED"})}}));const p={...m,onChange:({target:{name:E,value:f}})=>i({type:"ON_CHANGE",keys:E.split("."),value:f==="empty__string_value"?"":f}),onChangeSelectAll:({target:{name:E,value:f}})=>i({type:"ON_CHANGE_SELECT_ALL",keys:E.split("."),value:f}),onSelectedAction:E=>i({type:"SELECT_ACTION",actionToSelect:E})};return e.createElement(oe,{value:p},e.createElement(a.Grid,{gap:0,shadow:"filterShadow",hasRadius:!0,background:"neutral0"},e.createElement(a.GridItem,{col:7,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(a.Stack,{spacing:6},e.createElement(a.Stack,{spacing:2},e.createElement(a.Typography,{variant:"delta",as:"h2"},r({id:(0,O.Z)("Plugins.header.title"),defaultMessage:"Permissions"})),e.createElement(a.Typography,{as:"p",textColor:"neutral600"},r({id:(0,O.Z)("Plugins.header.description"),defaultMessage:"Only actions bound by a route are listed below."}))),e.createElement(Fe,null))),e.createElement(Se,null)))});de.propTypes={permissions:y().object.isRequired,routes:y().object.isRequired};var me=(0,e.memo)(de);const bt={isLoading:!0,modifiedData:{}},At=(t,n)=>produce(t,s=>{switch(n.type){case"GET_DATA":{s.isLoading=!0,s.modifiedData={};break}case"GET_DATA_SUCCEEDED":{s.isLoading=!1,s.modifiedData=n.data;break}case"GET_DATA_ERROR":{s.isLoading=!0;break}case"ON_SUBMIT_SUCCEEDED":{s.modifiedData=n.data;break}default:return s}});var Dt=null;const Lt=(t,n)=>{const{isLoading:s,allowedActions:r}=useRBAC(n),[{isLoading:m,modifiedData:i},l]=useReducer(reducer,initialState),u=useNotification(),g=useRef(!0),p=new AbortController,{signal:E}=p;useEffect(()=>(s||(async()=>{try{l({type:"GET_DATA"});const T=await request(getRequestURL(t),{method:"GET",signal:E});l({type:"GET_DATA_SUCCEEDED",data:T})}catch(T){g.current&&(l({type:"GET_DATA_ERROR"}),console.error(T),u({type:"warning",message:{id:"notification.error"}}))}})(),()=>{p.abort(),g.current=!1}),[s,t]);const f=useCallback(c=>{l({type:"ON_SUBMIT_SUCCEEDED",data:c})},[]);return{allowedActions:r,dispatchSubmitSucceeded:f,isLoading:m,isLoadingForPermissions:s,modifiedData:i}};var St=null;const Mt={roles:[],isLoading:!0},kt=(t,n)=>produce(t,s=>{switch(n.type){case"GET_DATA":{s.isLoading=!0,s.roles=[];break}case"GET_DATA_SUCCEEDED":{s.roles=n.data,s.isLoading=!1;break}case"GET_DATA_ERROR":{s.isLoading=!1;break}default:return s}});var Ot=null;const Bt=(t=!0)=>{const[{roles:n,isLoading:s},r]=useReducer(reducer,initialState,()=>init(initialState,t)),m=useNotification(),i=useRef(!0),l=new AbortController,{signal:u}=l;useEffect(()=>(t&&g(),()=>{l.abort(),i.current=!1}),[t]);const g=async()=>{try{r({type:"GET_DATA"});const{roles:p}=await request(`/${pluginId}/roles`,{method:"GET",signal:u});r({type:"GET_DATA_SUCCEEDED",data:p})}catch(p){const E=get(p,["response","payload","message"],"An error occured");i.current&&(r({type:"GET_DATA_ERROR"}),E!=="Forbidden"&&m({type:"warning",message:E}))}};return{roles:n,isLoading:s,getData:g}};var xt=null,We=(t,n)=>({...t,isLoading:n}),j=o(8917);const ge={permissions:{},routes:{},isLoading:!0};var ze=(t,n)=>(0,F.default)(t,s=>{switch(n.type){case"GET_DATA":{s.isLoading=!0,s.permissions={},s.routes={};break}case"GET_DATA_SUCCEEDED":{s.permissions=n.permissions,s.routes=n.routes,s.isLoading=!1;break}case"GET_DATA_ERROR":{s.isLoading=!1;break}default:return s}}),pe=(t=!0)=>{const n=(0,d.useNotification)(),[{permissions:s,routes:r,isLoading:m},i]=(0,e.useReducer)(ze,ge,()=>We(ge,t)),l=(0,e.useCallback)(async()=>{try{i({type:"GET_DATA"});const[{permissions:u},{routes:g}]=await Promise.all([`/${R.Z}/permissions`,`/${R.Z}/routes`].map(async p=>(await j.Z.get(p)).data));i({type:"GET_DATA_SUCCEEDED",permissions:(0,b.YX)(u),routes:g})}catch(u){const g=(0,L.get)(u,["response","payload","message"],"An error occured");i({type:"GET_DATA_ERROR"}),g!=="Forbidden"&&n({type:"warning",message:g})}},[n]);return(0,e.useEffect)(()=>{t&&l()},[l,t]),{permissions:s,routes:r,getData:l,isLoading:m}};const Ke={role:{},isLoading:!0};var Qe=(t,n)=>(0,F.default)(t,s=>{switch(n.type){case"GET_DATA_SUCCEEDED":{s.role=n.role,s.isLoading=!1;break}case"GET_DATA_ERROR":{s.isLoading=!1;break}case"ON_SUBMIT_SUCCEEDED":{s.role.name=n.name,s.role.description=n.description;break}default:return s}}),Ye=t=>{const[n,s]=(0,e.useReducer)(Qe,Ke),r=(0,d.useNotification)(),m=(0,e.useRef)(null);(0,e.useEffect)(()=>(m.current=!0,t?i(t):s({type:"GET_DATA_SUCCEEDED",role:{}}),()=>m.current=!1),[t]);const i=async u=>{try{const{data:{role:g}}=await j.Z.get(`/${R.Z}/roles/${u}`);m.current&&s({type:"GET_DATA_SUCCEEDED",role:g})}catch(g){console.error(g),s({type:"GET_DATA_ERROR"}),r({type:"warning",message:{id:"notification.error"}})}},l=(0,e.useCallback)(u=>{s({type:"ON_SUBMIT_SUCCEEDED",...u})},[]);return{...n,onSubmitSucceeded:l}},B=o(5173),Xe=B.Ry().shape({name:B.Z_().required(d.translatedErrors.required),description:B.Z_().required(d.translatedErrors.required)}),Je=()=>{const{formatMessage:t}=(0,P.useIntl)(),[n,s]=(0,e.useState)(!1),r=(0,d.useNotification)(),{lockApp:m,unlockApp:i}=(0,d.useOverlayBlocker)(),{params:{id:l}}=(0,C.useRouteMatch)(`/settings/${R.Z}/roles/:id`),{isLoading:u,routes:g}=pe(),{role:p,onSubmitSucceeded:E,isLoading:f}=Ye(l),c=(0,e.useRef)(),T=async v=>{m(),s(!0);try{const A=c.current.getPermissions();await j.Z.put(`/${R.Z}/roles/${l}`,{...v,...A,users:[]}),E({name:v.name,description:v.description}),r({type:"success",message:{id:(0,O.Z)("Settings.roles.edited"),defaultMessage:"Role edited"}})}catch(A){console.error(A),r({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})}s(!1),i()};return f?e.createElement(d.LoadingIndicatorPage,null):e.createElement(J.o,null,e.createElement(d.SettingsPageTitle,{name:"Roles"}),e.createElement(Q.Formik,{enableReinitialize:!0,initialValues:{name:p.name,description:p.description},onSubmit:T,validationSchema:Xe},({handleSubmit:v,values:A,handleChange:D,errors:x})=>e.createElement(d.Form,{noValidate:!0,onSubmit:v},e.createElement(Y.T,{primaryAction:!u&&e.createElement(q.z,{disabled:p.code==="strapi-super-admin",type:"submit",loading:n,startIcon:e.createElement(ne.Z,null)},t({id:"global.save",defaultMessage:"Save"})),title:p.name,subtitle:p.description,navigationAction:e.createElement(d.Link,{startIcon:e.createElement(Ce.Z,null),to:"/settings/users-permissions/roles"},t({id:"global.back",defaultMessage:"Back"}))}),e.createElement(X.D,null,e.createElement(N.K,{spacing:7},e.createElement(_.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(N.K,{spacing:4},e.createElement(se.Z,{variant:"delta",as:"h2"},t({id:(0,O.Z)("EditPage.form.roles"),defaultMessage:"Role details"})),e.createElement(ae.r,{gap:4},e.createElement($.P,{col:6},e.createElement(ee.o,{name:"name",value:A.name||"",onChange:D,label:t({id:"global.name",defaultMessage:"Name"}),error:x.name?t({id:x.name,defaultMessage:"Invalid value"}):null})),e.createElement($.P,{col:6},e.createElement(te.g,{name:"description",value:A.description||"",onChange:D,label:t({id:"global.description",defaultMessage:"Description"}),error:x.description?t({id:x.description,defaultMessage:"Invalid value"}):null}))))),!u&&e.createElement(me,{ref:c,permissions:p.permissions,routes:g}))))))},qe=()=>e.createElement(d.CheckPagePermissions,{permissions:h.Z.updateRole},e.createElement(Je,null)),_e=B.Ry().shape({name:B.Z_().required(d.translatedErrors.required),description:B.Z_().required(d.translatedErrors.required)}),et=()=>{const{formatMessage:t}=(0,P.useIntl)(),[n,s]=(0,e.useState)(!1),r=(0,d.useNotification)(),{goBack:m}=(0,C.useHistory)(),{lockApp:i,unlockApp:l}=(0,d.useOverlayBlocker)(),{isLoading:u,permissions:g,routes:p}=pe(),{trackUsage:E}=(0,d.useTracking)(),f=(0,e.useRef)(),c=async T=>{i(),s(!0);try{const v=f.current.getPermissions();await j.Z.post(`/${R.Z}/roles`,{...T,...v,users:[]}),E("didCreateRole"),r({type:"success",message:{id:(0,O.Z)("Settings.roles.created"),defaultMessage:"Role created"}}),m()}catch(v){console.error(v),r({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})}s(!1),l()};return e.createElement(J.o,null,e.createElement(d.SettingsPageTitle,{name:"Roles"}),e.createElement(Q.Formik,{enableReinitialize:!0,initialValues:{name:"",description:""},onSubmit:c,validationSchema:_e},({handleSubmit:T,values:v,handleChange:A,errors:D})=>e.createElement(d.Form,{noValidate:!0,onSubmit:T},e.createElement(Y.T,{primaryAction:!u&&e.createElement(q.z,{type:"submit",loading:n,startIcon:e.createElement(ne.Z,null)},t({id:"global.save",defaultMessage:"Save"})),title:t({id:"Settings.roles.create.title",defaultMessage:"Create a role"}),subtitle:t({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"})}),e.createElement(X.D,null,e.createElement(N.K,{spacing:7},e.createElement(_.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(N.K,{spacing:4},e.createElement(se.Z,{variant:"delta",as:"h2"},t({id:(0,O.Z)("EditPage.form.roles"),defaultMessage:"Role details"})),e.createElement(ae.r,{gap:4},e.createElement($.P,{col:6},e.createElement(ee.o,{name:"name",value:v.name||"",onChange:A,label:t({id:"global.name",defaultMessage:"Name"}),error:D.name?t({id:D.name,defaultMessage:"Invalid value"}):null})),e.createElement($.P,{col:6},e.createElement(te.g,{name:"description",value:v.description||"",onChange:A,label:t({id:"global.description",defaultMessage:"Description"}),error:D.description?t({id:D.description,defaultMessage:"Invalid value"}):null}))))),!u&&e.createElement(me,{ref:f,permissions:g,routes:p}))))))},tt=()=>e.createElement(d.CheckPagePermissions,{permissions:h.Z.createRole},e.createElement(et,null)),st=()=>e.createElement(d.CheckPagePermissions,{permissions:h.Z.accessRoles},e.createElement(C.Switch,null,e.createElement(C.Route,{path:`/settings/${R.Z}/roles/new`,component:tt,exact:!0}),e.createElement(C.Route,{path:`/settings/${R.Z}/roles/:id`,component:qe,exact:!0}),e.createElement(C.Route,{path:`/settings/${R.Z}/roles`,component:Re,exact:!0}),e.createElement(C.Route,{path:"",component:d.NotFound})))},8917:function(K,M,o){var e=o(55721),C=o(13478),d=o.n(C);const R=e.Z.create({baseURL:"http://localhost:1337"});R.interceptors.request.use(async h=>(h.headers={Authorization:`Bearer ${C.auth.getToken()}`,Accept:"application/json","Content-Type":"application/json"},h),h=>{Promise.reject(h)}),R.interceptors.response.use(h=>h,h=>{throw h.response?.status===401&&(C.auth.clearAppStorage(),window.location.reload()),h}),M.Z=R},59677:function(K,M,o){o.d(M,{be:function(){return e.Z},YX:function(){return R},Gc:function(){return k},OB:function(){return P.Z}});var e=o(8917),C=o(92891),R=S=>Object.keys(S).reduce((U,b)=>{const I=S[b].controllers,G=Object.keys(I).reduce((Z,y)=>((0,C.isEmpty)(I[y])||(Z[y]=I[y]),Z),{});return(0,C.isEmpty)(G)||(U[b]={controllers:G}),U},{}),h=o(90201),k=S=>`/${h.Z}/${S}`,P=o(82069)}}]);
