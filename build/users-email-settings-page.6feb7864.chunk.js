"use strict";(self.webpackChunk_strapi_admin=self.webpackChunk_strapi_admin||[]).push([[8418],{218:function(I,y,n){n.r(y),n.d(y,{default:function(){return k}});var e=n(32735),m=n(84968),M=n(5636),a=n(13478),t=n(39161),O=n(88369),l=n(59677);const P=async()=>{const{data:s}=await l.be.get((0,l.Gc)("email-templates"));return s},T=s=>l.be.put((0,l.Gc)("email-templates"),s);var h=n(60216),i=n.n(h),u=n(57269);const b=({canUpdate:s,onEditClick:d})=>{const{formatMessage:o}=(0,M.useIntl)();return e.createElement(t.Table,{colCount:3,rowCount:3},e.createElement(t.Thead,null,e.createElement(t.Tr,null,e.createElement(t.Th,{width:"1%"},e.createElement(t.VisuallyHidden,null,o({id:(0,l.OB)("Email.template.table.icon.label"),defaultMessage:"icon"}))),e.createElement(t.Th,null,e.createElement(t.Typography,{variant:"sigma",textColor:"neutral600"},o({id:(0,l.OB)("Email.template.table.name.label"),defaultMessage:"name"}))),e.createElement(t.Th,{width:"1%"},e.createElement(t.VisuallyHidden,null,o({id:(0,l.OB)("Email.template.table.action.label"),defaultMessage:"action"}))))),e.createElement(t.Tbody,null,e.createElement(t.Tr,{...(0,a.onRowClick)({fn:()=>d("reset_password")})},e.createElement(t.Td,null,e.createElement(t.Icon,null,e.createElement(u.Refresh,{"aria-label":o({id:"global.reset-password",defaultMessage:"Reset password"})}))),e.createElement(t.Td,null,e.createElement(t.Typography,null,o({id:"global.reset-password",defaultMessage:"Reset password"}))),e.createElement(t.Td,{...a.stopPropagation},e.createElement(t.IconButton,{onClick:()=>d("reset_password"),label:o({id:(0,l.OB)("Email.template.form.edit.label"),defaultMessage:"Edit a template"}),noBorder:!0,icon:s&&e.createElement(u.Pencil,null)}))),e.createElement(t.Tr,{...(0,a.onRowClick)({fn:()=>d("email_confirmation")})},e.createElement(t.Td,null,e.createElement(t.Icon,null,e.createElement(u.Check,{"aria-label":o({id:(0,l.OB)("Email.template.email_confirmation"),defaultMessage:"Email address confirmation"})}))),e.createElement(t.Td,null,e.createElement(t.Typography,null,o({id:(0,l.OB)("Email.template.email_confirmation"),defaultMessage:"Email address confirmation"}))),e.createElement(t.Td,{...a.stopPropagation},e.createElement(t.IconButton,{onClick:()=>d("email_confirmation"),label:o({id:(0,l.OB)("Email.template.form.edit.label"),defaultMessage:"Edit a template"}),noBorder:!0,icon:s&&e.createElement(u.Pencil,null)})))))};b.propTypes={canUpdate:i().bool.isRequired,onEditClick:i().func.isRequired};var v=b,B=n(83281),p=n(5173),A=p.Ry().shape({options:p.Ry().shape({from:p.Ry().shape({name:p.Z_().required(a.translatedErrors.required),email:p.Z_().email(a.translatedErrors.email).required(a.translatedErrors.required)}).required(),response_email:p.Z_().email(a.translatedErrors.email),object:p.Z_().required(a.translatedErrors.required),message:p.Z_().required(a.translatedErrors.required)}).required(a.translatedErrors.required)});const L=({template:s,onToggle:d,onSubmit:o})=>{const{formatMessage:r}=(0,M.useIntl)();return e.createElement(t.ModalLayout,{onClose:d,labelledBy:`${r({id:(0,l.OB)("PopUpForm.header.edit.email-templates"),defaultMessage:"Edit email template"})}, ${r({id:(0,l.OB)(s.display),defaultMessage:s.display})}`},e.createElement(t.ModalHeader,null,e.createElement(t.Breadcrumbs,{label:`${r({id:(0,l.OB)("PopUpForm.header.edit.email-templates"),defaultMessage:"Edit email template"})}, ${r({id:(0,l.OB)(s.display),defaultMessage:s.display})}`},e.createElement(t.Crumb,null,r({id:(0,l.OB)("PopUpForm.header.edit.email-templates"),defaultMessage:"Edit email template"})),e.createElement(t.Crumb,null,r({id:(0,l.OB)(s.display),defaultMessage:s.display})))),e.createElement(B.Formik,{onSubmit:o,initialValues:s,validateOnChange:!1,validationSchema:A,enableReinitialize:!0},({errors:c,values:E,handleChange:g,isSubmitting:C})=>e.createElement(a.Form,null,e.createElement(t.ModalBody,null,e.createElement(t.Grid,{gap:5},e.createElement(t.GridItem,{col:6,s:12},e.createElement(a.GenericInput,{intlLabel:{id:(0,l.OB)("PopUpForm.Email.options.from.name.label"),defaultMessage:"Shipper name"},name:"options.from.name",onChange:g,value:E.options.from.name,error:c?.options?.from?.name,type:"text"})),e.createElement(t.GridItem,{col:6,s:12},e.createElement(a.GenericInput,{intlLabel:{id:(0,l.OB)("PopUpForm.Email.options.from.email.label"),defaultMessage:"Shipper email"},name:"options.from.email",onChange:g,value:E.options.from.email,error:c?.options?.from?.email,type:"text"})),e.createElement(t.GridItem,{col:6,s:12},e.createElement(a.GenericInput,{intlLabel:{id:(0,l.OB)("PopUpForm.Email.options.response_email.label"),defaultMessage:"Response email"},name:"options.response_email",onChange:g,value:E.options.response_email,error:c?.options?.response_email,type:"text"})),e.createElement(t.GridItem,{col:6,s:12},e.createElement(a.GenericInput,{intlLabel:{id:(0,l.OB)("PopUpForm.Email.options.object.label"),defaultMessage:"Subject"},name:"options.object",onChange:g,value:E.options.object,error:c?.options?.object,type:"text"})),e.createElement(t.GridItem,{col:12,s:12},e.createElement(t.Textarea,{label:r({id:(0,l.OB)("PopUpForm.Email.options.message.label"),defaultMessage:"Message"}),name:"options.message",onChange:g,value:E.options.message,error:c?.options?.message&&r({id:c.options.message,defaultMessage:c.options.message})})))),e.createElement(t.ModalFooter,{startActions:e.createElement(t.Button,{onClick:d,variant:"tertiary"},"Cancel"),endActions:e.createElement(t.Button,{loading:C,type:"submit"},"Finish")}))))};L.propTypes={template:i().shape({display:i().string,icon:i().string,options:i().shape({from:i().shape({name:i().string,email:i().string}),message:i().string,object:i().string,response_email:i().string})}).isRequired,onSubmit:i().func.isRequired,onToggle:i().func.isRequired};var G=L;const j=()=>e.createElement(a.CheckPagePermissions,{permissions:O.Z.readEmailTemplates},e.createElement(Z,null)),Z=()=>{const{formatMessage:s}=(0,M.useIntl)(),{trackUsage:d}=(0,a.useTracking)(),{notifyStatus:o}=(0,t.useNotifyAT)(),r=(0,a.useNotification)(),{lockApp:c,unlockApp:E}=(0,a.useOverlayBlocker)(),g=(0,e.useRef)(d),C=(0,m.useQueryClient)();(0,a.useFocusWhenNavigate)();const[H,D]=(0,e.useState)(!1),[U,N]=(0,e.useState)(null),x=(0,e.useMemo)(()=>({update:O.Z.updateEmailTemplates}),[]),{isLoading:$,allowedActions:{canUpdate:w}}=(0,a.useRBAC)(x),{status:W,data:F}=(0,m.useQuery)("email-templates",()=>P(),{onSuccess(){o(s({id:(0,l.OB)("Email.template.data.loaded"),defaultMessage:"Email templates has been loaded"}))},onError(){r({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),K=$||W!=="success",R=()=>{D(f=>!f)},Q=f=>{N(f),R()},S=(0,m.useMutation)(f=>T({"email-templates":f}),{async onSuccess(){await C.invalidateQueries("email-templates"),r({type:"success",message:{id:"notification.success.saved",defaultMessage:"Saved"}}),g.current("didEditEmailTemplates"),E(),R()},onError(){r({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),E()},refetchActive:!0}),{isLoading:V}=S,q=f=>{c(),g.current("willEditEmailTemplates");const z={...F,[U]:f};S.mutate(z)};return K?e.createElement(t.Main,{"aria-busy":"true"},e.createElement(a.SettingsPageTitle,{name:s({id:(0,l.OB)("HeaderNav.link.emailTemplates"),defaultMessage:"Email templates"})}),e.createElement(t.HeaderLayout,{title:s({id:(0,l.OB)("HeaderNav.link.emailTemplates"),defaultMessage:"Email templates"})}),e.createElement(t.ContentLayout,null,e.createElement(a.LoadingIndicatorPage,null))):e.createElement(t.Main,{"aria-busy":V},e.createElement(a.SettingsPageTitle,{name:s({id:(0,l.OB)("HeaderNav.link.emailTemplates"),defaultMessage:"Email templates"})}),e.createElement(t.HeaderLayout,{title:s({id:(0,l.OB)("HeaderNav.link.emailTemplates"),defaultMessage:"Email templates"})}),e.createElement(t.ContentLayout,null,e.createElement(v,{onEditClick:Q,canUpdate:w}),H&&e.createElement(G,{template:F[U],onToggle:R,onSubmit:q})))};var k=j},8917:function(I,y,n){var e=n(55721),m=n(13478),M=n.n(m);const a=e.Z.create({baseURL:"http://localhost:1337"});a.interceptors.request.use(async t=>(t.headers={Authorization:`Bearer ${m.auth.getToken()}`,Accept:"application/json","Content-Type":"application/json"},t),t=>{Promise.reject(t)}),a.interceptors.response.use(t=>t,t=>{throw t.response?.status===401&&(m.auth.clearAppStorage(),window.location.reload()),t}),y.Z=a},59677:function(I,y,n){n.d(y,{be:function(){return e.Z},YX:function(){return a},Gc:function(){return l},OB:function(){return P.Z}});var e=n(8917),m=n(92891),a=T=>Object.keys(T).reduce((h,i)=>{const u=T[i].controllers,b=Object.keys(u).reduce((v,B)=>((0,m.isEmpty)(u[B])||(v[B]=u[B]),v),{});return(0,m.isEmpty)(b)||(h[i]={controllers:b}),h},{}),t=n(90201),l=T=>`/${t.Z}/${T}`,P=n(82069)}}]);
